---
title: "Detecting if Zune is Connected From Your NoDo/Mango App"
date: 2011-10-01T08:08:39.0000000
draft: false
featured_image: ""
---

<p><strong>Edit 2001/10/10: </strong>I noticed that I actually get InvalidOperationException on Mango (seems like all the time now, but I’m not 100% sure). Updated code in CaptureTask_Completed to check for this.</p>  <p>Rene had a great blog post about <a href="http://kodierer.blogspot.com/2010/12/windows-phone-unplugged-how-to-detect.html">How to detect the Zune software</a> about an year ago. Unfortunately, the method he describes no longer works in Mango.</p>  <p>Moreover, when you get the Cancel event from the PhotoChooserTask in Mango, neither OnNavigatingFrom nor OnNavigatedTo is called for your page.</p>  <p>This can cause crashes, grief and unhappy customers who think “I can’t open a picture from this app”.</p>  <p>Here is my current solution that works for NoDo and Mango. It’s very simple, I just check if the request to open the picture happened less than 1 second after the Cancel event occurred.</p>  <p>In real life testing (you should have seen me frantically hitting the back button!), one second seems to work great.</p>  <p>&#160;</p>  <p>Here’s some code to illustrate this:</p>  <p>[code:c#]</p>  <p>private void btnOpenFromPhone_Click(object sender, RoutedEventArgs e)    <br />{     <br />&#160;&#160;&#160; if (Globals.PhotoChooserTask == null)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Globals.PhotoChooserTask = new PhotoChooserTask();     <br />&#160;&#160;&#160; }</p>  <p>&#160;&#160;&#160; Globals.PhotoChooserTask.Completed += CaptureTask_Completed;    <br />&#160;&#160;&#160; Globals.PhotoChooserTask.ShowCamera = true;     <br />&#160;&#160;&#160; try     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Globals.PhotoChooserStarted = DateTime.Now;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Globals.PhotoChooserTask.Show();     <br />&#160;&#160;&#160; }     <br />&#160;&#160;&#160; catch (InvalidOperationException) // will be thrown in case we double-tap and other navigation is in progress     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160; }     <br />}</p>  <p>void CaptureTask_Completed(object sender, PhotoResult e)    <br />{     <br /></p>  <blockquote>   <p>if (e.Error != null)     <br />{      <br />&#160;&#160;&#160; if (e.Error is InvalidOperationException)      <br />&#160;&#160;&#160; {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; MessageBox.Show(&quot;The Zune software is running and prevents opening pictures. Please close Zune or disconnect the phone from your computer and try again.&quot;, &quot;Information&quot;, MessageBoxButton.OK);      <br />&#160;&#160;&#160; }      <br />&#160;&#160;&#160; return;      <br />}</p> </blockquote>  <p>&#160;&#160;&#160; if (e.TaskResult == TaskResult.OK)    <br />&#160;&#160;&#160; {</p>  <blockquote>   <p>// yay we’re done!</p> </blockquote>  <p>   <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return;     <br />&#160;&#160;&#160; }</p>  <p>&#160;&#160;&#160; if (e.Error is InvalidOperationException)    <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; throw e.Error;     <br />&#160;&#160;&#160; }</p>  <p>&#160;&#160;&#160; if (e.TaskResult == TaskResult.Cancel)    <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; AvailableTools.Brush.SetImage(Globals.MainImage); // set the image back to the brush again, because in case of Zune connected to PC OnNavigatingFrom and OnNavigatedTo will not be called!</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; if ((DateTime.Now - Globals.PhotoChooserStarted) &lt; TimeSpan.FromSeconds(1)) // returned too fast, assume Zune is causing problems    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; MessageBox.Show(&quot;The Zune software is running and prevents opening pictures. Please close Zune or disconnect the phone from your computer and try again.&quot;, &quot;Information&quot;, MessageBoxButton.OK);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }     <br />&#160;&#160;&#160; }     <br />}</p>  <p>[/code]</p>  <p>If anyone knows a better solution, please let me know!</p>